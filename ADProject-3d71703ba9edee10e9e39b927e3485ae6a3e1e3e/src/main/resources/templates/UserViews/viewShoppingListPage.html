<!DOCTYPE html>
<html>
	<head>
		<title>
			View Shopping List
		</title>
		
		<script>
			document.addEventListener("DOMContentLoaded", function(event) {
				const checkboxes = document.getElementsByClassName('shoppingListItem')
				for (const checkbox of checkboxes) {
					checkbox.addEventListener('change', (event) => {
						updateCheckedStatus(checkbox, event.currentTarget.checked);
						var row = checkbox.closest('tr');
						if (checkbox.checked) {
							row.querySelector('.itemText').style.color = 'grey';
						} else {
							row.querySelector('.itemText').style.color = '';
						}
					})
				}
			});
			
			function updateCheckedStatus(checkbox, isChecked) {
			    const id = parseInt(checkbox.id);
			    console.log("id: " + id);
			    
			    let xhr = new XMLHttpRequest();
			    xhr.open("POST", "/user/shoppingList/updateCheckedStatus");
			    xhr.setRequestHeader("Content-Type", "application/json; charset=utf8");
			    xhr.onreadystatechange = function () {
			        if (xhr.readyState == 4 && xhr.status == 200) {
			            console.log("response ok");
			        }
			    }
			    let data = {
			        "id": id,
			        "isChecked" : isChecked,
			    }
			    xhr.send(JSON.stringify(data));    
			}
		</script>
	</head>
	<body>
		<div>
			<h2>Shopping List</h2>
		</div>
		<table>
			<tr th:each="item : ${shoppingList}">
				<td>
					<input type="checkbox" class="shoppingListItem" th:id="${item.id}" th:checked="${item.isChecked}"/>
				</td>
				<td th:text="${item.ingredientName}" class="itemText" >
					Shopping List Item
				</td>
			</tr>
		</table>
		<br />
		<button type="button" onclick="window.location.href='/user/shoppingList/edit';">Edit</button>
	</body>
</html>