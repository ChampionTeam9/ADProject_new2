<!DOCTYPE html>
<html>
	<head>
		<title>
			View Shopping List
		</title>
		<link href="/style.css" rel="stylesheet"/>
		<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
		<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
  		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>
		<script>
			document.addEventListener("DOMContentLoaded", function(event) {
				const checkboxes = document.getElementsByClassName('shoppingListItem')
				for (const checkbox of checkboxes) {
					checkbox.addEventListener('change', (event) => {
						updateCheckedStatus(checkbox, event.currentTarget.checked);
						updateRowStyle(checkbox);
					})
				}
			});
			
			function updateCheckedStatus(checkbox, isChecked) {
			    const id = parseInt(checkbox.id);
			    console.log("id: " + id);
			    
			    let xhr = new XMLHttpRequest();
			    xhr.open("POST", "/user/shoppingList/updateCheckedStatus");
			    xhr.setRequestHeader("Content-Type", "application/json; charset=utf8");
			    xhr.onreadystatechange = function () {
			        if (xhr.readyState == 4 && xhr.status == 200) {
			            console.log("response ok");
			        }
			    }
			    let data = {
			        "id": id,
			        "isChecked" : isChecked,
			    }
			    xhr.send(JSON.stringify(data));    
			}
			
			function updateRowStyle(checkbox){
				var row = checkbox.closest('tr');
				if (checkbox.checked) {
					row.querySelector('.itemText').style.color = 'grey';
					row.querySelector('.itemText').style.textDecoration = 'line-through';
				} else {
					row.querySelector('.itemText').style.color = '';
					row.querySelector('.itemText').style.textDecoration = 'none';
				}
			}
		</script>
	</head>
	<body>
		<div class="custom-container">
			<div th:replace="fragments/navbar"></div>
		</div>
		<div class="custom-container">
			<div>
				<h2>Shopping List</h2>
			</div>
			<table>
				<tr th:each="item : ${shoppingList}">
					<td>
						<input type="checkbox" class="shoppingListItem" th:id="${item.id}" th:checked="${item.isChecked}"/>
					</td>
					<td th:text="${item.ingredientName}" class="itemText" th:style="${item.isChecked ? 'color: grey; text-decoration: line-through;' : ''}">
						Shopping List Item
					</td>
				</tr>
			</table>
			<br />
			<button type="button" onclick="window.location.href='/user/shoppingList/edit';">Edit</button>
		</div>
	</body>
</html>