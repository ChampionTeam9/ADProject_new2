<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<title>My Recipe List</title>
	<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
	<link href="/style.css" rel="stylesheet" />
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
	<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>
	<!-- Add your CSS links or styles here -->
	<style>
		.dropdown-content {
			display: none;
		}

		/* 这里可以添加其他样式 */
	</style>

</head>

<body>

	<!-- Navigation -->
	<a th:href="@{/recipe/create}">Add Recipe</a>

	<!-- Recipe List -->
	<div th:each="recipe : ${recipes}">
		<div class="recipe-box">
			<h3 th:text="${recipe.name}"></h3>
			<a th:href="@{/recipe/view/{id}(id=${recipe.id})}">
				< img th:src="@{${recipe.image}}" alt="Recipe Image" class="recipe-image">
					<div class="options-menu">
						<button class="options-btn" onclick="toggleDropdown(event)"> &#8226;&#8226;&#8226;</button>

						<div class="dropdown-content" id="myDropdown">
							<a th:href="@{/recipe/edit/{id}(id=${recipe.id})}">Modify</a>
							Delete
						</div>
					</div>
		</div>
	</div>
	<!-- Add your JavaScript code for delete confirmation here -->
	<script>
		function deleteRecipe(recipeId) {
			var confirmDelete = confirm("Are you sure you want to delete this recipe?");
			if (confirmDelete) {
				$.ajax({
					type: "DELETE",
					url: "/recipe/delete/" + recipeId,
					success: function (data) {
						window.location.replace("/recipe/list");
					},
					error: function (error) {
						console.error("Error deleting recipe: " + error.responseText);
					}
				});

			}
		}

		function toggleDropdown(event) {
			event.preventDefault();  // 阻止按钮的默认行为
			var dropdown = document.getElementById("myDropdown");
			dropdown.style.display = (dropdown.style.display === 'block') ? 'none' : 'block';
		}

		// Close the dropdown if the user clicks outside of it
		window.onclick = function (event) {
			if (!event.target.matches('.options-btn')) {
				var dropdowns = document.getElementsByClassName("dropdown-content");
				for (var i = 0; i < dropdowns.length; i++) {
					var openDropdown = dropdowns[i];
					if (openDropdown.style.display === 'block') {
						openDropdown.style.display = 'none';
					}
				}
			}
		}
	</script>

</body>

</html>