<!-- dashboard.html -->
<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<title>Dashboard</title>
	<link href="/style.css" rel="stylesheet" />
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
	<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
</head>

<body>
	<div class="custom-container">
		<div th:replace="fragments/navbar"></div>
	</div>
	<div class="container" style="width: 80%;">
		<h2>Dashboard</h2>
	</div>

	<div class="container" style="width: 80%;">
		<div class="row justify-content-center">
			<div class="col-md-6">
				<div class="card mb-3">
					<div class="card-body">
						<h2 class="card-title" th:text="${numberOfMemberReports}">0</h2>
						<p class="card-text" style="font-size: large;">Member report pending for approval</p>
						<a href="/user/admin/memberReport" class="btn btn-primary">Details</a>
					</div>
				</div>
			</div>
			<div class="col-md-6">
				<div class="card mb-3">
					<div class="card-body">
						<h2 class="card-title" th:text="${numberOfRecipeReports}">0</h2>
						<p class="card-text" style="font-size: large;">Recipe report pending for approval</p>
						<a href="/user/admin/recipeReport" class="btn btn-primary">Details</a>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div class="container" style="width: 80%;">
		<div class="page-divide-container">
			<div class="two-thirds-column" style="margin-right: 30px;">
				<canvas id="recipeChart" style="width:100%;max-width:700px"></canvas>
				<input type="hidden" id="months" th:value="${months}" />
				<input type="hidden" id="recipeCountByMonth" th:value="${recipeCountByMonth}" />
			</div>
			<div class="one-third-column">
				<canvas id="tagChart" style="width:100%;max-width:500px;height:600px;"></canvas>
				<input type="hidden" id="tags" th:value="${tags}" />
				<input type="hidden" id="recipeCountByTag" th:value="${recipeCountByTag}" />
			</div>
		</div>
	</div>
	<script th:inline="javascript">
		document.addEventListener("DOMContentLoaded", function (event) {
			plotRecipeChart();
			plotTagChart();
		});

		function plotRecipeChart() {
			let xValuesString = document.getElementById("months").value;
			xValuesString = xValuesString.substring(1, xValuesString.length - 1);
			const xValues = xValuesString.split(",").map(month => month.trim());
			const yValues = JSON.parse(document.getElementById("recipeCountByMonth").value);
			const recipeChart = new Chart("recipeChart", {
				type: "line",
				data: {
					labels: xValues,
					datasets: [{
						fill: false,
						lineTension: 0,
						backgroundColor: "rgba(0,0,255,1.0)",
						borderColor: "rgba(0,0,255,0.1)",
						data: yValues
					}]
				},
				options: {
					legend: {display: false},
					title: {
						display: true,
						text: "Recipes Submitted in 2003"
					}
				}
			});
		}

		function plotTagChart() {
			let xValuesString = document.getElementById("tags").value;
			xValuesString = xValuesString.substring(1, xValuesString.length - 1);
			const xValues = xValuesString.split(",").map(tag => tag.trim());
			console.log(xValues);
			const yValues = JSON.parse(document.getElementById("recipeCountByTag").value);
			console.log(yValues);
			new Chart("tagChart", {
				type: "horizontalBar",
				data: {
					labels: xValues,
					datasets: [{
						backgroundColor: "#5cb85c",
						data: yValues
					}]
				},
				options: {
					legend: {display: false},
					title: {
						display: true,
						text: "Top tags"
					},
					scales: {
						xAxes: [{
							categoryPercentage: 2.0, // Adjust the space between bars
							barPercentage: 1.0 // Adjust the width of bars
						}]
					}
				}
			});
		}
	</script>
</body>

</html>